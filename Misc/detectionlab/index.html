<!doctype html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="lang:clipboard.copy" content="Copy to clipboard"><meta name="lang:clipboard.copied" content="Copied to clipboard"><meta name="lang:search.language" content="en"><meta name="lang:search.pipeline.stopwords" content="True"><meta name="lang:search.pipeline.trimmer" content="True"><meta name="lang:search.result.none" content="No matching documents"><meta name="lang:search.result.one" content="1 matching document"><meta name="lang:search.result.other" content="# matching documents"><meta name="lang:search.tokenizer" content="[\s\-]+"><link rel="shortcut icon" href="../../assets/images/favicon.png"><meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.3.1"><title>Setting Up Detection Lab - Mike's Site</title><link rel="stylesheet" href="../../assets/stylesheets/application.4031d38b.css"><link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css"><meta name="theme-color" content="#fb8c00"><script src="../../assets/javascripts/modernizr.74668098.js"></script><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=swap"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel="stylesheet" href="../../assets/fonts/material-icons.css"><link rel="stylesheet" href="../../css/html.css"></head><body dir="ltr" data-md-color-primary="orange" data-md-color-accent="indigo"><svg class="md-svg"><defs></defs></svg> <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off"> <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off"> <label class="md-overlay" data-md-component="overlay" for="__drawer"></label><a href="#setting-up-detection-lab-on-linux-mint-191" tabindex="1" class="md-skip">Skip to content </a><header class="md-header" data-md-component="header"><nav class="md-header-nav md-grid"><div class="md-flex"><div class="md-flex__cell md-flex__cell--shrink"><a href="../.." title="Mike's Site" class="md-header-nav__button md-logo"><i class="md-icon">security</i></a></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label></div><div class="md-flex__cell md-flex__cell--stretch"><div class="md-flex__ellipsis md-header-nav__title" data-md-component="title"><span class="md-header-nav__topic">Mike's Site</span><span class="md-header-nav__topic">Setting Up Detection Lab</span></div></div><div class="md-flex__cell md-flex__cell--shrink"><label class="md-icon md-icon--search md-header-nav__button" for="__search"></label><div class="md-search" data-md-component="search" role="dialog"><label class="md-search__overlay" for="__search"></label><div class="md-search__inner" role="search"><form class="md-search__form" name="search"><input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active"> <label class="md-icon md-search__icon" for="__search"></label> <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button></form><div class="md-search__output"><div class="md-search__scrollwrap" data-md-scrollfix><div class="md-search-result" data-md-component="result"><div class="md-search-result__meta">Type to start searching</div><ol class="md-search-result__list"></ol></div></div></div></div></div></div></div></nav></header><div class="md-container"><main class="md-main"><div class="md-main__inner md-grid" data-md-component="container"><div class="md-sidebar md-sidebar--primary" data-md-component="navigation"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--primary" data-md-level="0"><label class="md-nav__title md-nav__title--site" for="__drawer"><a href="../.." title="Mike's Site" class="md-nav__button md-logo"><i class="md-icon">security</i></a>Mike's Site</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../README.md" title="Home" class="md-nav__link">Home</a></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2"><label class="md-nav__link" for="nav-2">External Resources</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-2">External Resources</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="https://digital-forensics.sans.org/" title="SANS DFIR Website" class="md-nav__link">SANS DFIR Website</a></li></ul></nav></li><li class="md-nav__item md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3"><label class="md-nav__link" for="nav-3">Documentation</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-3">Documentation</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="../../documentation/installing-mkdocs/" title="Installing MkDocs" class="md-nav__link">Installing MkDocs</a></li></ul></nav></li><li class="md-nav__item md-nav__item--active md-nav__item--nested"><input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked><label class="md-nav__link" for="nav-4">Security Engineering</label><nav class="md-nav" data-md-component="collapsible" data-md-level="1"><label class="md-nav__title" for="nav-4">Security Engineering</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item md-nav__item--active"><input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc"><label class="md-nav__link md-nav__link--active" for="__toc">Setting Up Detection Lab</label><a href="./" title="Setting Up Detection Lab" class="md-nav__link md-nav__link--active">Setting Up Detection Lab</a><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#install-configure-virtualbox" title="Install &amp; Configure VirtualBox" class="md-nav__link">Install &amp; Configure VirtualBox</a></li><li class="md-nav__item"><a href="#install-detection-lab-and-prereqs" title="Install Detection Lab and Prereqs" class="md-nav__link">Install Detection Lab and Prereqs</a></li><li class="md-nav__item"><a href="#build-detection-lab" title="Build Detection Lab" class="md-nav__link">Build Detection Lab</a></li></ul></nav></li></ul></nav></li></ul></nav></div></div></div><div class="md-sidebar md-sidebar--secondary" data-md-component="toc"><div class="md-sidebar__scrollwrap"><div class="md-sidebar__inner"><nav class="md-nav md-nav--secondary"><label class="md-nav__title" for="__toc">Table of contents</label><ul class="md-nav__list" data-md-scrollfix><li class="md-nav__item"><a href="#install-configure-virtualbox" title="Install &amp; Configure VirtualBox" class="md-nav__link">Install &amp; Configure VirtualBox</a></li><li class="md-nav__item"><a href="#install-detection-lab-and-prereqs" title="Install Detection Lab and Prereqs" class="md-nav__link">Install Detection Lab and Prereqs</a></li><li class="md-nav__item"><a href="#build-detection-lab" title="Build Detection Lab" class="md-nav__link">Build Detection Lab</a></li></ul></nav></div></div></div><div class="md-content"><article class="md-content__inner md-typeset"><h1 id="setting-up-detection-lab-on-linux-mint-191">Setting Up Detection Lab on Linux Mint 19.1<a class="headerlink" href="#setting-up-detection-lab-on-linux-mint-191" title="Permanent link">&para;</a></h1>
<p>This was my process for setting up the awesome <a href="https://github.com/clong/DetectionLab">Detection Lab</a> project by <a href="https://twitter.com/Centurion?lang=en">Chris Long</a>.  I referenced <a href="https://taosecurity.blogspot.com/2019/01/trying-detectionlab.html">Richard Bejtlich's write-up</a> as well as Part 1 of <a href="https://blog.agood.cloud/posts/2019/02/13/building-detection-lab-in-aws/">Building Detection Lab in AWS</a>.  I installed Detection Lab on Linux Mint 19.1 running on an Intel NUC with 6<sup>th</sup>-gen i3 processor (dual-core w/ hyperthreading), 32 GB RAM, and 256 GB SSD.  </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>I did most of the steps below and then ran into the following error when running the build script at the end:</p>
<p><code>VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component MachineWrap, interface IMachine</code>.  </p>
<p>The problem turned out to be that I was performing the install via SSH.  After troubleshooting for a while, I found an error in the <code>DetectionLab\Vagrant\vagrant_up_logger.log</code> file that showed the <code>vboxmanage</code> command starting with <code>--type gui</code>.  Realizing that was not going to work via my SSH connection to my lab machine, I switched to the desktop to re-run the build script.  It then worked like a champ.  As each virtual machine was started during the install, the console screen for the VM would pop up and then complete the configuration changes to the VM.  I didn't realize that a headless install was not supported.  So make sure you are doing this at the GUI desktop console (at least when running the <code>build.sh</code> script).</p>
</div>
<h2 id="install-configure-virtualbox">Install &amp; Configure VirtualBox<a class="headerlink" href="#install-configure-virtualbox" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Started with a new install of Linux Mint 19.1.  After applying all updates (<code>sudo apt-get update -y &amp;&amp; sudo apt-get dist-upgrade -y</code>), I added screen &amp; ssh server with <code>sudo apt-get update screen ssh</code>.  (But as mentioned above, don't use SSH to run the build script at the end.)</p>
</li>
<li>
<p>Now install the latest version of VirtualBox using the <a href="https://www.virtualbox.org/wiki/Linux_Downloads">VitualBox guide for Linux</a>.  (The <code>apt</code> repository is stil verison 5, so you need to install the newer version 6 from the VirtuaBox repo.)  First I added <code>deb https://download.virtualbox.org/virtualbox/debian &lt;mydist&gt; contrib</code>  (my Mint/Ubuntu distro is <code>bionic</code>) to <code>/etc/apt/sources.list</code>.  Then I ran the following to complete the VirtualBox install:</p>
<div class="codehilite"><pre><span></span>wget -q https://www.virtualbox.org/download/oracle_vbox_2016.asc -O- | sudo apt-key add -
wget -q https://www.virtualbox.org/download/oracle_vbox.asc -O- | sudo apt-key add -
sudo apt-get update
sudo apt-get install virtualbox-6.0
</pre></div>

</li>
<li>
<p>Next download the the latest extension pack from the <a href="https://www.virtualbox.org/wiki/Downloads">main downloads page</a> and install it:</p>
<div class="codehilite"><pre><span></span>sudo VBoxManage extpack install &lt;extension-pack-version&gt;.vbox-extpack
</pre></div>

</li>
<li>
<p>Now add your account to the local VirtualBox group:
    <div class="codehilite"><pre><span></span>sudo usermod -aG vboxusers &lt;your username&gt;
</pre></div></p>
</li>
<li>
<p>To validate the VirtualBox install, I suggest verifying that you can create and run a VM.  You don't even need to install an OS in the VM.  Just make sure it will create a run a VM even though you will get a "No bootable medium found" message after start up.  From a terminal on the desktop, run <code>VirtualBox &amp;</code> to bring up the window.  Create a VM and run it.  Then close VirtualBox once you've tested a running VM.</p>
</li>
</ul>
<h2 id="install-detection-lab-and-prereqs">Install Detection Lab and Prereqs<a class="headerlink" href="#install-detection-lab-and-prereqs" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Next install <code>git</code> and download Detection Lab:</p>
<p><div class="codehilite"><pre><span></span>sudo apt-get install git
</pre></div>
<div class="codehilite"><pre><span></span>git clone https://github.com/clong/DetectionLab.git
</pre></div></p>
</li>
<li>
<p>Install Vagrant from the <a href="https://www.vagrantup.com/docs/installation/">vendor's site</a>.  Use the instructions provided there. Pay attention to the notes, such as not using the prepackaged version and disabling other hypervisors (I disabled kvm, although I may not have needed to since I was able to successfully run a VM earlier).  I downloaded and installed their current .deb package with:</p>
<div class="codehilite"><pre><span></span>sudo apt install ./vagrant_2.2.4_x86_64.deb 
</pre></div>

</li>
<li>
<p>If building your own Windows VMs, also install Packer from the <a href="https://www.packer.io/intro/getting-started/install.html">vendor's site</a>.  Use the instructions provided there.  I downloaded their 64-bit Linux binary and unzipped it into <code>/usr/sbin</code>.</p>
</li>
<li>
<p>Install the vagrant-reload plugin:</p>
<div class="codehilite"><pre><span></span>vagrant plugin install vagrant-reload
</pre></div>

</li>
<li>
<p>Now reboot your host.</p>
</li>
</ul>
<h2 id="build-detection-lab">Build Detection Lab<a class="headerlink" href="#build-detection-lab" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>As my standard user account, I kicked off the install with the option of using the Vagrant Cloud boxes, which are automatically downloaded with the <code>--vagrantonly</code> option:</p>
<div class="codehilite"><pre><span></span>./build.sh virtualbox --vagrantonly
</pre></div>

</li>
<li>
<p>As mentioned in the warning box above, I ran into errors with this build process until I realized that it needs to be performed on the GUI desktop.  Once I moved to the desktop, installation went smoothly and finished in less than 2 hours.</p>
</li>
<li>
<p>Here's a look at the finished product:</p>
</li>
</ul>
<p><img alt="" src="../media/finished-detection-lab.png" /></p></article></div></div></main><footer class="md-footer"><div class="md-footer-nav"><nav class="md-footer-nav__inner md-grid"><a href="../../documentation/installing-mkdocs/" title="Installing MkDocs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev"><div class="md-flex__cell md-flex__cell--shrink"><i class="md-icon md-icon--arrow-back md-footer-nav__button"></i></div><div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"><span class="md-flex__ellipsis"><span class="md-footer-nav__direction">Previous</span>Installing MkDocs</span></div></a></nav></div><div class="md-footer-meta md-typeset"><div class="md-footer-meta__inner md-grid"><div class="md-footer-copyright">powered by <a href="https://www.mkdocs.org">MkDocs</a> and <a href="https://squidfunk.github.io/mkdocs-material/">Material for MkDocs</a></div></div></div></footer></div><script src="../../assets/javascripts/application.b260a35d.js"></script><script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script></body></html>